@using Microsoft.AspNetCore.Html
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<SharedResource> Localizer

@{
    ViewData["Title"] = $"{Localizer["MenuRole"]}";

    var breadcrumb = new List<(string, string, string)>
{
("Home", "Index", "Home"),
("Role", "", "")
};
    var headerParams = new { PageTitle = $"{Localizer["MenuRole"]}", breadcrumb };

    var tableRender = new HtmlString(@"<thead>
<tr>
<th width='5%'><inputtype='checkbox'id='checkAll'></th>
<th width='15%'>Role</th>
<th width='25%'>Deskripsi</th>
<th width='10%'>Actions</th>
</tr>
</thead>
<tbody></tbody>
<tfoot>
<tr>
<th></th>
<th><input type='text'class='form-control'placeholder='SearchRole'/></th>
<th><input type='text'class='form-control'placeholder='SearchDescription'/></th>
<th></th>
</tr>
</tfoot>");

    var tableId = new ViewDataDictionary(ViewData) { { "TableId", "role" } };
    var contentModalDelete = new HtmlString(@"<p>Anda yakin ingin hapus data ?</p><p id='content'></p> ");
    var idModalDelete = new ViewDataDictionary(ViewData) { { "ModalId", "modal-delete" }, { "FormId", "formHapus" } };
    var contentModalMultiDelete = new HtmlString(@"<p>Anda yakin ingin hapus data yang terpilih ?</p><input type='hidden'
name='datahapus' id='datahapus' value=''> ");
    var idModalMultiDelete = new ViewDataDictionary(ViewData) { {"ModalId","modal-multidelete" }, { "FormId",
"formHapusMulti" } };
}

@await Component.InvokeAsync("PageHeader", headerParams)

<div class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <card-layout title="Data @Localizer["MenuRole"]" button-create-link="Role/Create"
                    button-multiple-delete="true">
                    @await Html.PartialAsync("Components/_TableOuter", tableRender, tableId)
                </card-layout>
            </div>
        </div>
    </div>
</div>

@await Html.PartialAsync("Components/_ModalDelete", contentModalDelete, idModalDelete)

@await Html.PartialAsync("Components/_ModalDelete", contentModalMultiDelete, idModalMultiDelete)

@section Styles
{
    @{
        await Html.RenderPartialAsync("_DatatableStylesPartial");
    }
}

@section Scripts {
    @{
        await Html.RenderPartialAsync("_DatatableScriptsPartial");
    }
    <script src="~/helpers/js/format-date.js"></script>
    <script src="~/helpers/js/format-rupiah.js"></script>
    <script src="~/helpers/js/multi-delete.js"></script>
    <script type="text/template" id="tpl-button-dropdown">
                @await Html.PartialAsync("Components/_ButtonDropdown", new HtmlString(@"<div class='dropdown-menu' style=''>__BTN__</div>"))
            </script>
    <script type="text/template" id="tpl-button-edit">
                @await Html.PartialAsync("Components/_ButtonEdit", new ViewDataDictionary(ViewData) { { "LinkPath", "__LINK__" } })
            </script>
    <script type="text/template" id="tpl-button-delete">
                @await Html.PartialAsync("Components/_ButtonDelete", new ViewDataDictionary(ViewData) { { "DataId", "__DATAID__" }, { "DataTitle", "__DATATITLE__" } })
            </script>
    <script type="text/template" id="tpl-loading-icon">
                @await Html.PartialAsync("Components/_LoadingIcon", new ViewDataDictionary(ViewData) { { "DataId", "__DATAID__" }, { "DataTitle", "__DATATITLE__" } })
            </script>
    <script>
        $(async function () {
            let columns = [{
                data: 'id',
                orderable: false,
                searchable: false,
                render: function (data, type, row, meta) {
                    let check = `<input name='idpilih[]' type="checkbox" id="checkItem" value="${row.id}">`;
                    if (row.name.toLowerCase() === "administrator") {
                        check = ""
                    }
                    return check;
                }
            },
            {
                data: 'name',
                render: function (data, type, row, meta) {
                    return `${row.name}`;
                }
            },
            {
                data: 'description',
                render: function (data, type, row, meta) {
                    return `${row.description}`;
                }
            },
            {
                data: 'id',
                orderable: false,
                searchable: false,
                render: function (data, type, row, meta) {
                    let id = row.id;
                    let title = row.name;

                    let tpl = $("#tpl-button-edit").html();
                    tpl = tpl.replace("__LINK__", `/role/edit/${id}`);

                    let tplDelete = $("#tpl-button-delete").html();
                    tplDelete = tplDelete.replace("__DATAID__", id);
                    tplDelete = tplDelete.replace("__DATATITLE__", title);

                    if (row.name.toLowerCase() === "administrator") {
                        tplDelete = "";
                    }

                    let tplDropdown = $("#tpl-button-dropdown").html()
                    tplDropdown = tplDropdown.replace("__BTN__", tpl + tplDelete)

                    let html = '';
                    html += tplDropdown;
                    return html;
                }
            }
            ];

            let options = {
                isEnabled: true,
                saveState: false,
                hoverClass: 'dt-colresizable-hover',
                hasBoundCheck: true,
                minBoundClass: 'dt-colresizable-bound-min',
                maxBoundClass: 'dt-colresizable-bound-max',
                isResizable: function (column) {
                    return true;
                },
                onResizeStart: function (column, columns) {
                },
                onResize: function (column) {
                },
                onResizeEnd: function (column, columns) {
                },
                getMinWidthOf: function ($thNode) {
                },
                stateSaveCallback: function (settings, data) {
                },
                stateLoadCallback: function (settings) {
                }
            };

            let dtURL = "@Url.Action("GetData", "Role")";
            let deleteDataUrl = `/role/delete/:id`;

            const dt = await dataTableRender(dtURL, columns, options, "POST", deleteDataUrl, 1, 'role')
        });

        $("#btn-delete-multi").on("click", function () {
            let multiDeleteDataUrl = `/role/multi-delete`;
            hapusmulti(multiDeleteDataUrl);
        });

        $("#formHapusMulti").submit(function (e) {
            let tpl = $("#tpl-loading-icon").html();
            $(".delete").html(tpl);
            $(".delete").prop("disabled", true);
        });
    </script>
}